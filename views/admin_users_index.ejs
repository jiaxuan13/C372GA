<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>FluffyFriend ‚Äî Users</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{
      --pink-50:#fff6fb;
      --pink-200:#ffd9ec;
      --pink-500:#ff6fa3;
      --pink-600:#ff4f92;
      --violet-900:#241933;
      --text-muted:#857a93;
    }
    html,body{height:100%;margin:0;display:flex;flex-direction:column;background:var(--pink-50);font-family:'Segoe UI',sans-serif}
    body::before{
      content:'';
      position:fixed;
      inset:0;
      background:
        radial-gradient(circle at 20% 20%,rgba(255,255,255,.85),transparent 55%),
        radial-gradient(circle at 80% 0,#ffe6f3,transparent 45%);
      z-index:-1;
    }
    main{flex:1;padding-bottom:3rem}
    .navbar{background:linear-gradient(90deg,#ff8db8,#ff6fa3)}
    .navbar-brand{color:#fff;font-weight:700}
    .nav-link{color:#fff!important;border-radius:8px;padding:8px 14px;transition:.3s}
    .nav-link:hover{background:#ff8db8}
    .btn-pink{background:#ff6fa3;border:none}.btn-pink:hover{background:#ff8db8}
    .btn-ghost{background:#fff;border:1px solid var(--pink-200);color:var(--pink-600);border-radius:14px;font-weight:600}
    .card-soft{background:#fff;border-radius:22px;box-shadow:0 20px 50px rgba(0,0,0,.08);border:0}
    .users-hero{
      background:linear-gradient(135deg,#fff,var(--pink-200));
      border-radius:32px;
      box-shadow:0 30px 65px rgba(255,111,163,.25);
      padding:32px;
      margin-bottom:2rem;
      position:relative;
      overflow:hidden;
    }
    .users-hero::after{
      content:'';
      position:absolute;
      inset:0;
      background:radial-gradient(circle at 95% 5%,rgba(255,255,255,.8),transparent 50%);
      pointer-events:none;
    }
    .hero-tags{display:flex;gap:.65rem;flex-wrap:wrap;margin-bottom:1rem}
    .hero-tag{background:rgba(255,111,163,.15);color:var(--pink-600);font-weight:600;border-radius:999px;padding:.35rem .95rem;font-size:.85rem}
    .hero-actions{display:flex;gap:.75rem;flex-wrap:wrap;margin-top:1.5rem}
    .stats-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:2rem}
    .stat-card{background:#fff;border-radius:20px;padding:18px 22px;box-shadow:0 15px 40px rgba(0,0,0,.08)}
    .stat-card small{text-transform:uppercase;letter-spacing:.08em;font-size:.72rem;color:var(--text-muted)}
    .stat-card strong{display:block;font-size:1.4rem;margin-top:.35rem;color:var(--violet-900)}
    .table-shell{background:#fff;border-radius:26px;padding:1.5rem;box-shadow:0 30px 70px rgba(0,0,0,.08)}
    .table-toolbar{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;margin-bottom:1rem}
    .table-toolbar h3{margin:0;font-weight:700}
    .users-table thead{background:var(--pink-200)}
    .users-table th{border-bottom:none;font-size:.75rem;text-transform:uppercase;letter-spacing:.05em;color:var(--text-muted)}
    .users-table td{border-top:1px solid rgba(0,0,0,.05)}
    .badge-role{background:rgba(0,0,0,.08);color:#333;border-radius:999px;padding:.2rem .75rem;font-size:.8rem;text-transform:uppercase}
    footer{background:linear-gradient(90deg,#ff8db8,#ff6fa3);color:#fff;padding:12px 0;margin-top:auto}
  </style>
</head>
<body>
  <!-- Navbar. -->
  <nav class="navbar">
    <div class="container d-flex justify-content-between">
      <a class="navbar-brand" href="/">üêæ FluffyFriend</a>
      <div>
        <a class="nav-link d-inline" href="/admin">Admin</a>
        <a class="nav-link d-inline" href="/logout">Logout</a>
      </div>
    </div>
  </nav>

  <main class="container my-4">
    <% if (success && success.length) { %>
      <div class="alert alert-success"><%= success[0] %></div>
    <% } %>
    <% if (error && error.length) { %>
      <div class="alert alert-danger"><%= error[0] %></div>
    <% } %>

    <% var totalUsers = users ? users.length : 0; %>
    <% var admins = users ? users.filter(function(u){ return u.role === 'admin'; }).length : 0; %>
    <% var regulars = totalUsers - admins; %>

    <section class="users-hero">
      <div class="hero-tags">
        <span class="hero-tag">User Hub</span>
        <span class="hero-tag">Active: <%= totalUsers %></span>
      </div>
      <h2 class="fw-bold mb-1">Manage your community</h2>
      <p class="text-muted mb-2">Keep FluffyFriend safe and friendly by tracking who has access and what roles they play.</p>
      <div class="hero-actions">
        <a class="btn btn-pink text-white" href="/admin/users/new">Add new user</a>
        <a class="btn btn-ghost" href="/admin">Back to dashboard</a>
      </div>
    </section>

    <% var today = new Date(); %>

    <div class="stats-row">
      <div class="stat-card">
        <small>Total members</small>
        <strong><%= totalUsers %></strong>
        <p class="text-muted mb-0">All users listed in the system.</p>
      </div>
      <div class="stat-card">
        <small>Admins</small>
        <strong><%= admins %></strong>
        <p class="text-muted mb-0">Users with elevated access.</p>
      </div>
      <div class="stat-card">
        <small>Regular users</small>
        <strong><%= regulars %></strong>
        <p class="text-muted mb-0">Members enjoying the store.</p>
      </div>
      <div class="stat-card">
        <small>Today</small>
        <strong><%= today.toDateString() %></strong>
        <p class="text-muted mb-0">All systems are running.</p>
      </div>
    </div>

    <div class="table-shell">
      <div class="table-toolbar">
        <h3 class="mb-0">Directory</h3>
        <div class="ms-auto d-flex gap-2 flex-wrap">
          <a href="/admin" class="btn btn-outline-secondary">Back</a>
          <a href="/admin/users/new" class="btn btn-pink text-white">Add User</a>
        </div>
      </div>
      <div class="table-responsive">
        <table class="table users-table align-middle mb-0">
          <thead>
            <tr>
              <th style="width:60px">#</th>
              <th>Username</th>
              <th>Email</th>
              <th>Address</th>
              <th>Contact</th>
              <th>Role</th>
              <th style="width:170px" class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% if (users && users.length) { %>
              <% users.forEach((u, index) => { %>
                <tr>
                  <td><%= index + 1 %></td>
                  <td class="fw-semibold"><%= u.username %></td>
                  <td><%= u.email %></td>
                  <td><%= u.address %></td>
                  <td><%= u.contact %></td>
                  <td><span class="badge-role"><%= u.role %></span></td>
                  <td class="text-end">
                    <a href="/admin/users/<%= u.id %>/edit" class="btn btn-sm btn-outline-secondary me-2">Edit</a>
                    <form action="/admin/users/<%= u.id %>/delete" method="post" class="d-inline" onsubmit="return confirm('Delete this user?');">
                      <button class="btn btn-sm btn-outline-danger">Delete</button>
                    </form>
                  </td>
                </tr>
              <% }) %>
            <% } else { %>
              <tr>
                <td colspan="7" class="text-center text-muted py-4">No users found.</td>
              </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <footer>
    <div class="container d-flex justify-content-between align-items-center">
      <small>¬© <%= new Date().getFullYear() %> FluffyFriend.</small>
      <small>Made with ‚ô• in a pink theme.</small>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
