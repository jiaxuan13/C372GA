<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>FluffyFriend ‚Äî Products</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    html, body {
      height: 100%;
      margin: 0;
      display: flex;
      flex-direction: column;
      font-family: 'Segoe UI', sans-serif;
      background: radial-gradient(circle at top, #ffe4f4 0, #ffd6ef 25%, #ffedf7 60%, #ffeef8 100%);
    }
    main { flex: 1; }

    .navbar-fluffy {
      background: linear-gradient(90deg,#ff8db8,#ff6fa3);
      padding: 10px 0;
    }
    .navbar-brand {
      font-weight: 700;
      color:#fff !important;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .brand-icon {
      width:34px;
      height:34px;
      border-radius:50%;
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:20px;
    }

    .flash-wrapper {
      max-width:900px;
      margin:16px auto 0;
    }

    .search-bar-wrapper {
      max-width:900px;
      margin:8px auto 10px;
      display:flex;
      gap:8px;
      align-items:center;
    }
    .search-input {
      flex:1;
      border-radius:999px;
      border:none;
      padding:10px 18px;
      font-size:0.95rem;
      box-shadow:0 3px 8px rgba(0,0,0,.08);
    }
    .search-button {
      border:none;
      border-radius:999px;
      padding:10px 22px;
      background:#ff6fa3;
      color:#fff;
      font-weight:600;
      box-shadow:0 3px 8px rgba(0,0,0,.15);
    }

    .filter-bar {
      max-width:900px;
      margin:6px auto 24px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .filter-pill {
      border-radius:999px;
      border:none;
      padding:6px 14px;
      font-size:0.85rem;
      background:#ffe0f0;
      color:#ff4c93;
      font-weight:500;
    }
    .filter-pill.active {
      background:#ff6fa3;
      color:#fff;
    }

    .product-grid {
      max-width:1050px;
      margin:0 auto 40px;
    }
    .product-card {
      border-radius:18px;
      background:linear-gradient(180deg,#ffe6f3,#ffd9ef);
      border:none;
      padding:18px 18px 16px;
      box-shadow:0 5px 16px rgba(0,0,0,.08);
      height:100%;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }
    .paw-icon {
      width:70px;
      height:70px;
      border-radius:50%;
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:36px;
      color:#ff6fa3;
      margin:12px auto;
    }
    .product-name {
      font-size:0.98rem;
      font-weight:700;
      margin-bottom:4px;
      text-align:center;
    }
    .product-desc {
      font-size:0.8rem;
      color:#7b6c80;
      margin-bottom:10px;
      min-height:32px;
      text-align:center;
    }
    .price {
      font-weight:700;
      color:#ff4c93;
      font-size:0.95rem;
    }
    .price-row {
      margin-top:8px;
      text-align:center;
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-fluffy">
    <div class="container d-flex justify-content-between align-items-center">
      <a class="navbar-brand" href="/">
        <div class="brand-icon">üêæ</div>
        <span>FluffyFriend</span>
      </a>
    </div>
  </nav>

  <main>
    <% 
      const selCategory = (typeof selectedCategory !== 'undefined' ? selectedCategory : '');
      const q = (typeof query !== 'undefined' ? query : '');
    %>

    <!-- Flash messages -->
    <div class="flash-wrapper">
      <% if (success && success.length) { %>
        <div class="alert alert-success py-2"><%= success[0] %></div>
      <% } %>
      <% if (error && error.length) { %>
        <div class="alert alert-danger py-2"><%= error[0] %></div>
      <% } %>
    </div>

    <!-- Search bar -->
    <div class="search-bar-wrapper">
      <form class="d-flex w-100" method="GET" action="/products">
        <input
          type="text"
          name="q"
          class="search-input"
          placeholder="Search food, toys, grooming..."
          value="<%= q %>"
        />
        <button class="search-button" type="submit">Search</button>
      </form>
    </div>

    <!-- Filter pills -->
    <div class="filter-bar">
      <button type="button"
              class="filter-pill <%= !selCategory ? 'active' : '' %>"
              onclick="location.href='/products'">All</button>

      <button type="button"
              class="filter-pill <%= selCategory === 'Food' ? 'active' : '' %>"
              onclick="location.href='/products?category=Food'">Food</button>

      <button type="button"
              class="filter-pill <%= selCategory === 'Toys' ? 'active' : '' %>"
              onclick="location.href='/products?category=Toys'">Toys</button>

      <button type="button"
              class="filter-pill <%= selCategory === 'Grooming' ? 'active' : '' %>"
              onclick="location.href='/products?category=Grooming'">Grooming</button>

      <button type="button"
              class="filter-pill <%= selCategory === 'Healthcare' ? 'active' : '' %>"
              onclick="location.href='/products?category=Healthcare'">Healthcare</button>
    </div>

    <!-- Product cards -->
    <div class="product-grid container">
      <div class="row g-4">
        <% if (products && products.length) { %>
          <% products.forEach(function (p) { %>
            <div class="col-12 col-sm-6 col-md-4 col-lg-3">
              <div class="product-card">

                <!-- IMAGE from DB -->
                <% if (p.image) { %>
                  <div class="text-center">
                    <img
                      src="/images/products/<%= p.image %>"
                      alt="<%= p.productName %>"
                      class="img-fluid rounded-3 mb-2"
                      style="max-height:160px; object-fit:cover;"
                    >
                  </div>
                <% } else { %>
                  <div class="paw-icon">üêæ</div>
                <% } %>

                <!-- NAME -->
                <div class="product-name"><%= p.productName %></div>

                <!-- DESC -->
                <div class="product-desc">
                  <%= p.description ? p.description : (p.category || '') %>
                </div>

                <!-- PRICE -->
                <div class="price-row">
                  <span class="price">$<%= Number(p.price).toFixed(2) %></span>
                </div>

              </div>
            </div>
          <% }); %>
        <% } else { %>
          <div class="col-12 text-center py-5">
            <p>No products found.</p>
          </div>
        <% } %>
      </div>
    </div>
  </main>

  <%- include('partials/footer') %>

</body>
</html>
